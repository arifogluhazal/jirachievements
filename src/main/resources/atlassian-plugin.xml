<atlassian-plugin key="${project.groupId}.${project.artifactId}" name="JIRA Hero" plugins-version="2">
  <plugin-info>
    <description>${project.description}</description>
    <version>${project.version}</version>
    <vendor name="${project.organization.name}" url="${project.organization.url}"/>
  </plugin-info>

  <!-- Active objects declaration -->
  <ao key="ao-module">
    <description>The module configuring the Active Objects service used by this plugin</description>
    <entity>com.madgnome.jira.plugins.jirachievements.data.ao.Achievement</entity>
    <entity>com.madgnome.jira.plugins.jirachievements.data.ao.Config</entity>
    <entity>com.madgnome.jira.plugins.jirachievements.data.ao.Level</entity>
    <entity>com.madgnome.jira.plugins.jirachievements.data.ao.ComponentStatistic</entity>
    <entity>com.madgnome.jira.plugins.jirachievements.data.ao.ProjectStatistic</entity>
    <entity>com.madgnome.jira.plugins.jirachievements.data.ao.VersionStatistic</entity>
    <entity>com.madgnome.jira.plugins.jirachievements.data.ao.StatisticRef</entity>
    <entity>com.madgnome.jira.plugins.jirachievements.data.ao.UserAchievement</entity>
    <entity>com.madgnome.jira.plugins.jirachievements.data.ao.UserStatistic</entity>
    <entity>com.madgnome.jira.plugins.jirachievements.data.ao.UserWrapper</entity>
    <upgradeTask>com.madgnome.jira.plugins.jirachievements.data.upgrades.v1.InitDatabaseTask</upgradeTask>
  </ao>

  <!-- Components Import -->
  <component-import key="userUtil" interface="com.atlassian.jira.user.util.UserUtil"/>
  <component-import key="salUserManager" interface="com.atlassian.sal.api.user.UserManager"/>
  <component-import key="webResourceManager" interface="com.atlassian.plugin.webresource.WebResourceManager" />
  <component-import key="templateRenderer" interface="com.atlassian.templaterenderer.TemplateRenderer"/>
  <component-import key="eventPublisher" interface="com.atlassian.event.api.EventPublisher"/>
  <component-import key="jqlParser" interface="com.atlassian.jira.jql.parser.JqlQueryParser"/>
  <component-import key="avatarService" interface="com.atlassian.jira.avatar.AvatarService"/>
  <component-import key="pluginScheduler" interface="com.atlassian.sal.api.scheduling.PluginScheduler"/>
  <component-import key="applicationProperties" interface="com.atlassian.sal.api.ApplicationProperties"/>

  <component-import key="activeObjects" interface="com.atlassian.activeobjects.external.ActiveObjects"/>

  <!-- Components -->
  <component key="tx-processor" name="Transactional Annotation Processor"
             class="com.atlassian.activeobjects.external.TransactionalAnnotationProcessor">
    <decription>Processes @Transactional annotations.</decription>
  </component>

  <component key="issueSearcher" class="com.madgnome.jira.plugins.jirachievements.utils.data.IssueSearcher"/>

  <!-- Components : Listeners -->
  <component key="issueListener" class="com.madgnome.jira.plugins.jirachievements.listeners.IssueAchievementsEventListener"/>
  <component key="oldEventListener" class="com.madgnome.jira.plugins.jirachievements.listeners.OldFashionUserEventListener"/>
  <component key="eventListener" class="com.madgnome.jira.plugins.jirachievements.listeners.UserCreationEventListener"/>

  <!-- Components : Initializers -->
  <component key="achievementsInitializer" class="com.madgnome.jira.plugins.jirachievements.utils.initializers.AchievementsInitializer"/>
  <component key="configsInitializer" class="com.madgnome.jira.plugins.jirachievements.utils.initializers.ConfigsInitializer"/>
  <component key="levelsInitializer" class="com.madgnome.jira.plugins.jirachievements.utils.initializers.LevelsInitializer"/>
  <component key="statisticsInitializer" class="com.madgnome.jira.plugins.jirachievements.utils.initializers.StatisticsRefInitializer"/>
  <!--<component key="userWrappersInitializer" class="com.madgnome.jira.plugins.jirachievements.utils.initializers.UserWrappersInitializer"/>-->

  <!-- Components : Managers -->
  <component key="pluginComponentManager" class="com.madgnome.jira.plugins.jirachievements.utils.PluginComponentManager"/>
  <component key="statisticManager" class="com.madgnome.jira.plugins.jirachievements.services.StatisticManager"/>
  <component key="userManager" class="com.madgnome.jira.plugins.jirachievements.services.UserManager"/>
  <component key="achievementManager" class="com.madgnome.jira.plugins.jirachievements.services.AchievementManager"/>

  <!-- Components : DAO -->
  <component key="achievementDaoService" interface="com.madgnome.jira.plugins.jirachievements.data.services.IAchievementDaoService"
             class="com.madgnome.jira.plugins.jirachievements.data.services.impl.AchievementDaoService"/>

  <component key="configDaoService" interface="com.madgnome.jira.plugins.jirachievements.data.services.IConfigDaoService"
             class="com.madgnome.jira.plugins.jirachievements.data.services.impl.ConfigDaoService"/>

  <component key="levelDaoService" class="com.madgnome.jira.plugins.jirachievements.data.services.impl.LevelDaoService"
             interface="com.madgnome.jira.plugins.jirachievements.data.services.ILevelDaoService"/>

  <component key="projectStatisticDaoService" inteface="com.madgnome.jira.plugins.jirachievements.data.services.IProjectStatisticDaoService"
             class="com.madgnome.jira.plugins.jirachievements.data.services.impl.ProjectStatisticDaoService"/>

  <component key="projectComponentStatisticDaoService" inteface="com.madgnome.jira.plugins.jirachievements.data.services.IProjectComponentStatisticDaoService"
             class="com.madgnome.jira.plugins.jirachievements.data.services.impl.ProjectComponentStatisticDaoService"/>

  <component key="projectVersionDaoService" inteface="com.madgnome.jira.plugins.jirachievements.data.services.IProjectVersionStatisticDaoService"
             class="com.madgnome.jira.plugins.jirachievements.data.services.impl.ProjectVersionStatisticDaoService"/>

  <component key="statisticRefDaoService" interface="com.madgnome.jira.plugins.jirachievements.data.services.IStatisticRefDaoService"
             class="com.madgnome.jira.plugins.jirachievements.data.services.impl.StatisticRefDaoService"/>

  <component key="userAchievementDaoService" interface="com.madgnome.jira.plugins.jirachievements.data.services.IUserAchievementDaoService"
             class="com.madgnome.jira.plugins.jirachievements.data.services.impl.UserAchievementDaoService"/>

  <component key="userStatisticDaoService" interface="com.madgnome.jira.plugins.jirachievements.data.services.IUserStatisticDaoService"
             class="com.madgnome.jira.plugins.jirachievements.data.services.impl.UserStatisticDaoService"/>

  <component key="userWrapperDaoService" interface="com.madgnome.jira.plugins.jirachievements.data.services.IUserWrapperDaoService"
             class="com.madgnome.jira.plugins.jirachievements.data.services.impl.UserWrapperDaoService"/>

  <!-- Components : Statistics -->
  <component key="openedByUserStatistic" class="com.madgnome.jira.plugins.jirachievements.statistics.OpenedByUserStatistic"/>
  <component key="resolvedByUserStatistic" class="com.madgnome.jira.plugins.jirachievements.statistics.ResolvedByUserStatistic"/>
  <component key="closedByUserStatistic" class="com.madgnome.jira.plugins.jirachievements.statistics.ClosedByUserStatistic"/>

  <!-- Resources -->
  <resource type="download" name="images/" location="includes/images/"/>
  <resource type="download" name="css/" location="includes/css/"/>
  <resource type="download" name="js/" location="includes/js/"/>

  <web-resource name="Notifications resources" key="ja-notification">
    <resource name="jquery.jgrowl_minimized.js" type="download" location="includes/js/plugins/jquery.jgrowl.js"/>
    <resource name="jquery.corner.js" type="download" location="includes/js/plugins/jquery.corner.js"/>
    <resource name="notification.js" type="download" location="includes/js/notification.js"/>
    <resource name="jquery.cookie.js" type="download" location="/includes/js/plugins/jquery.cookie.js"/>
    <resource name="jquery.illuminate.js" type="download" location="/includes/js/plugins/jquery.illuminate.js"/>

    <resource name="jquery.jgrowl.css" type="download" location="includes/css/plugins/jquery.jgrowl.css"/>
    <resource name="notification.css" type="download" location="includes/css/notification.css"/>
    <resource type="download" name="achievements.css" location="includes/css/achievements.css"/>
    <resource type="download" name="levels.css" location="includes/css/levels.css"/>
    <dependency>com.atlassian.auiplugin:ajs</dependency>

    <context>atl.general</context>
    <context>atl.admin</context>
  </web-resource>

  <web-resource name="JQuery UI" key="jh-jquery-ui">
    <resource name="jquery-ui.js" type="download" location="/includes/js/plugins/jquery-ui-1.8.12.custom.min.js"/>
    <resource name="jquery-ui.css" type="download" location="/includes/css/plugins/redmond/jquery-ui-1.8.12.custom.css"/>
    <resource name="jquery.flot.js" type="download" location="/includes/js/plugins/jquery.flot.js"/>
    <resource name="jquery.flot.resize.js" type="download" location="/includes/js/plugins/jquery.flot.resize.js"/>
  </web-resource>

  <web-resource name="Header User Details resources" key="jh-header-user-details">
    <resource name="header-details-user.js" type="download" location="includes/js/header-details-user.js"/>

    <context>atl.general</context>
    <context>atl.admin</context>
  </web-resource>

  <web-resource name="User achievements resources" key="jh-user-achievements-details">
    <resource name="jquery.masonry.js" type="download" location="includes/js/plugins/jquery.masonry.js"/>
  </web-resource>

  <!-- Achievements in user profile-->
  <view-profile-panel key="achievements-profile" i18n-name-key="Achievements"
                      name="User Profile Roadmap Panel"
                      class="com.madgnome.jira.plugins.jirachievements.ui.AchievementViewProfilePanel"
                      application="jira">
    <order>40</order>
  </view-profile-panel>

  <web-item key="achievements-page-link" section="system.user.options/personal">
    <label>Achievements</label>
    <link>/secure/ViewProfile.jspa#selectedTab=com.madgnome.jira.plugins.jirachievements:achievements-profile</link>
  </web-item>

  <!-- Leaderboard tab panel -->
  <project-tabpanel key="project-leaderboard-panel" name="Project Leaderboard Panel"
                    class="com.madgnome.jira.plugins.jirachievements.ui.LeaderBoardProjectTabPanel">
    <label>LeaderBoard</label>
    <order>80</order>
    <resource type="velocity" name="view" location="/templates/com/madgnome/jira/plugins/jirachievements/leaderboard.vm" />
  </project-tabpanel>

  <component-tabpanel key="component-leaderboard-panel" name="Component Leaderboard Panel"
                      class="com.madgnome.jira.plugins.jirachievements.ui.LeaderBoardComponentTabPanel">
    <label>LeaderBoard</label>
    <order>80</order>
    <resource type="velocity" name="view" location="/templates/com/madgnome/jira/plugins/jirachievements/leaderboard.vm" />
  </component-tabpanel>

  <version-tabpanel key="version-leaderboard-panel" name="Component Leaderboard Panel"
                      class="com.madgnome.jira.plugins.jirachievements.ui.LeaderBoardVersionTabPanel">
    <label>LeaderBoard</label>
    <order>80</order>
    <resource type="velocity" name="view" location="/templates/com/madgnome/jira/plugins/jirachievements/leaderboard.vm" />
  </version-tabpanel>

  <!-- REST -->
  <rest key="rest-service-resources" path="/jirachievement" version="1.0">
    <description>Provides the REST resources for JIRAchievement plugin.</description>
  </rest>

  <!-- Configuration -->
  <web-item key="jh-config-webfragment-old" name="JIRA Hero Config Web Fragment" section="system.admin/globalsettings"
              weight="90" system="true">
    <condition class="com.atlassian.jira.plugin.webfragment.conditions.JiraGlobalPermissionCondition">
      <param name="permission">admin</param>
    </condition>
    <condition class="com.madgnome.jira.plugins.jirachievements.utils.conditions.IsPriorToJiraVersion">
      <param name="majorVersion">4</param>
      <param name="minorVersion">4</param>
    </condition>
    <label>JIRA Hero Configuration</label>
    <link linkId="jh_global_config">/secure/admin/ViewJIRAHeroGlobalConfiguration.jspa</link>
  </web-item>

  <web-item key="jh-config-webfragment" name="JIRA Hero Config Web Fragment" section="admin_plugins_menu/agile_section" weight="10">
      <condition class="com.atlassian.jira.plugin.webfragment.conditions.JiraGlobalPermissionCondition">
        <param name="permission">admin</param>
      </condition>
      <label>JIRA Hero Configuration</label>
      <link linkId="jh_global_config">/secure/admin/ViewJIRAHeroGlobalConfiguration.jspa</link>
  </web-item>

  <webwork1 key="jh-config-action" name="JIRA Hero Config Screen">
    <actions>
      <action name="com.madgnome.jira.plugins.jirachievements.ui.action.admin.ViewGlobalConfiguration" alias="ViewJIRAHeroGlobalConfiguration">
        <view name="success">/templates/com/madgnome/jira/plugins/jirachievements/config/view-global-config.vm</view>
        <view name="error">/templates/com/madgnome/jira/plugins/jirachievements/error.vm</view>
      </action>
    </actions>
  </webwork1>

  <!-- Rules -->
  <component key="welcomeRule" class="com.madgnome.jira.plugins.jirachievements.rules.WelcomeRule"/>
  <component key="padawanRule" class="com.madgnome.jira.plugins.jirachievements.rules.PadawanRule"/>
  <component key="lostArkRaiderRule" class="com.madgnome.jira.plugins.jirachievements.rules.LostArkRaiderRule"/>
  <component key="insomniacExpressoRule" class="com.madgnome.jira.plugins.jirachievements.rules.InsomniacExpressoRule"/>

</atlassian-plugin>