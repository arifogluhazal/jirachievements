#* @vtlvariable name="achievements" type="java.util.Map<com.madgnome.jira.plugins.jirachievements.data.ao.Category, java.util.List<com.madgnome.jira.plugins.jirachievements.data.ao.Achievement>>" *#

#macro (categoryAchievements $categoryName)
  <div class="achievements-list">
    #foreach ($achievement in $achievements.get($categoryName))
      #parse ('/templates/com/madgnome/jira/plugins/jirachievements/achievement-detail.vm')
    #end
  </div>
#end

#macro (categoryMeter $categoryName)
  #set ($currentCategory = $achievements.get($categoryName))
  <meter min="0" max="100" value="40">25 /100</meter>
#end

#macro (histogram $percentage)
<table border="0" cellpadding="0" cellspacing="0" width="100%">
    #if ($percentage.intValue() != 0)
        #set ($newPercentage = 5)
        #if ($percentage.intValue() > 5)
            #set ($newPercentage = $percentage.intValue())
        #end
    <tr>
        <td style="width:${newPercentage}%" class="colour-bar-cont" valign="center">
            <div class="colour-bar"></div>
        </td>
        #set ($remainder = 100 - $newPercentage)
        <td  style="width:$remainder%">&nbsp;&nbsp;&nbsp;$percentage%</td>
    </tr>
    #else
    <tr>
        <td width="1px" class="colour-bar-cont" valign="center">
            <div class="colour-bar"></div>
        </td>
        <td>&nbsp;</td>
    </tr>
    #end
</table>
#end

<div id="primary" class="column full">
  <div class="content">
    <div class="module">
      <div class="mod-header">
        <h3>Summary</h3>
      </div>
      <div class="mod-content">
        <table cellpadding="2" cellspacing="0" style="width: 100%">
          <tbody>
            <tr>
              <td class="name">User</td>
              <td class="count">25</td>
              <td class="graph last">
                #histogram(25)
              </td>
            </tr>
            <tr class="rowAlternateLightGray">
              <td class="name">Developer</td>
              <td class="count">25</td>
              <td class="graph last">
                #histogram(75)
              </td>
            </tr>
            <tr class="">
              <td class="name">Tester</td>
              <td class="count">25</td>
              <td class="graph last">
                #histogram(60)
              </td>
            </tr>
            <tr class="rowAlternateLightGray">
              <td class="name">Agilist</td>
              <td class="count">25</td>
              <td class="graph last">
                #histogram(5)
              </td>
            </tr>
          </tbody>
        </table>
##        <div class="achievements-summary">
##          <dl class="table-display">
##            <dt>User</dt>
##            <dd><p><meter min="0" max="100" value="40">25 /100</meter></p></dd>
##            <dt>Developer</dt>
##            <dd><p><meter min="0" max="100" value="25">25 /100</meter></p></dd>
##            <dt>Tester</dt>
##            <dd><p><meter min="0" max="100" value="5">25 /100</meter></p></dd>
##            <dt>Agilist</dt>
##            <dd><p><meter min="0" max="100" value="0">25 /100</meter></p></dd>
##          </dl>
##        </div>
      </div>
    </div>


  </div>
  <div class="content">
    <div class="module">
      <div class="mod-header">
        <h3>Details</h3>
      </div>

      <div class="mod-content" id="achievements-details">
        <div class="aui-tabs horizontal-tabs" id="horizontal">
          <ul class="tabs-menu">
            <li class="menu-item active-tab first">
              <a href="#horizontal-first"><strong>User</strong></a>
            </li>
            <li class="menu-item">
              <a href="#horizontal-second"><strong>Developer</strong></a>
            </li>
            <li class="menu-item">
              <a href="#horizontal-third"><strong>Tester</strong></a>
            </li>
            <li class="menu-item">
              <a href="#horizontal-fourth"><strong>Agilist</strong></a>
            </li>
          </ul>
          <div class="tabs-pane active-pane" id="horizontal-first">
            #categoryAchievements("USER")
          </div>
          <div class="tabs-pane" id="horizontal-second">
            #categoryAchievements("DEVELOPER")
          </div>
          <div class="tabs-pane" id="horizontal-third">
            #categoryAchievements("TESTER")
          </div>
          <div class="tabs-pane" id="horizontal-fourth">
            #categoryAchievements("AGILIST")
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

##<div id="secondary" class="column">
##  <div class="content">
##    <div class="module">
##      <div class="mod-header">
##        <h3>Levels</h3>
##      </div>
##      <div class="mod-content">
##      </div>
##    </div>
##  </div>
##</div>

<script type="text/javascript">
  jQuery(document).ready(function() {

  jQuery('#achievements-details').bind('tabSelect', function() {
    jQuery('.active-pane > .achievements-list').masonry({
      singleMode: true,
      itemSelector : '.achievement-full'
    });
  });

  jQuery('.active-pane > .achievements-list').masonry({
      singleMode: true,
      itemSelector : '.achievement-full'
    });
  });
</script>
